<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <div class="content">
    <div class="container-fluid">
      <div class="row gx-2 gy-2">
        <div class="col-sm-3">
          <form [formGroup]="runCustomQueryform">
            <div class="row gx-2 mb-2">
              <div class="col-sm-4">
                <button type="submit" class="btn btn-light btn-sm w-100" (click)="onSubmitRunCustomQuery()"
                  [disabled]="runCustomQueryform.invalid">
                  <div *ngIf="!runcustomQueryForm_loading"><i class="fas fa-play" style="color: green;"></i></div>
                  <div *ngIf="runcustomQueryForm_loading" class="spinner-border spinner-border-sm" style="color: green;"
                    role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </button>
              </div>
              <div class="col-sm-4">
                <button class="btn btn-sm btn-light w-100" (click)="resetRunCustomQueryForm($event)"><i
                    class="fas fa-redo-alt" style="color: red;"></i></button>
              </div>
              <div class="col-sm-4">
                <button class="btn btn-sm btn-light shadow w-100" (click)="showAllQueriesDialog()"><i
                    class="far fa-chart-bar" style="color: blue;"></i></button>
              </div>
            </div>
            <div class="row gx-2 mb-2">
              <div class="col-sm-4">
                <button class="btn btn-sm btn-light shadow-none w-100" (click)="clieckedOnSave();save()"
                  [disabled]="runCustomQueryform.invalid"> <i class="fas fa-save" style="color: black;"></i></button>
              </div>
              <div class="col-sm-4">
                <button class="btn btn-sm btn-light shadow-none w-100" (click)="clieckedOnSaveAs();save()"
                  [disabled]="runCustomQueryform.invalid">
                  <i class="fas fa-copy" style="color: black;"></i></button>
              </div>
              <div class="col-sm-4">
                <button class="btn btn-sm btn-light shadow w-100" (click)="addChartInfo()"
                  [disabled]="runCustomQueryform.invalid && resultData.length<1"><i
                    class="fas fa-plus-square"></i></button>
              </div>
            </div>
            <div class="row mt-2 mb-2" *ngIf="selectedWorkspace">
              <div class="col-sm-12 d-flex">
                <div class="input-group input-group-sm">
                  <input type="text" formControlName="CustomQueryName"
                    [value]="runCustomQueryform.get('CustomQueryName')!.value" class="form-control shadow-none"
                    placeholder="Workspace name" aria-label="Workspace name" aria-describedby="button-addon2">
                  <button class="btn btn-secondary shadow-none" style="z-index: 0;"
                    (click)="setValidatorToWorkspaceName()" type="button" id="button-addon2">
                    <i class="fas fa-pen"></i>
                  </button>
                  <button class="btn btn-sm btn-secondary shadow-sm" style="z-index: 0;" (click)="instantSave()">
                    <div *ngIf="!saveCustomQuery_loading"><i class="far fa-save"></i></div>
                    <div *ngIf="saveCustomQuery_loading" class="spinner-border spinner-border-sm text-primary"
                      role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                  </button>
                </div>
              </div>
            </div>
            <tabset [justified]="true">
              <tab heading="New" customClass="customClass">
                <div class="accordion" id="accordionPanelsStayOpenExample">
                  <div class="accordion-item">
                    <div class="accordion-header" id="panelsStayOpen-headingOne">
                      <button class="accordion-button shadow-none py-1 px-2" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true"
                        aria-controls="panelsStayOpen-collapseOne">
                        Dataset Selection <span class="required">*</span>
                      </button>
                    </div>
                    <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show"
                      aria-labelledby="panelsStayOpen-headingOne">
                      <div class="accordion-body px-2">
                        <div class="mb-2">
                          <select class="form-select form-select-sm shadow-none" aria-label="Default select example"
                            formControlName="ConnectionStringId" (change)="onSelectConnectionString($event)"
                            [ngClass]="{ 'is-invalid': f['ConnectionStringId'].touched && f['ConnectionStringId'].errors }">
                            <option value={{default_select}} selected>Select Connection...</option>
                            <option value={{connectionString.connectionStringId}}
                              *ngFor="let connectionString of connectionStrings">
                              {{connectionString.connectionName}}
                            </option>
                          </select>
                        </div>
                        <div class="mb-0">
                          <select class="form-select form-select-sm shadow-none" aria-label="Default select example"
                            formControlName="TableName" (change)="onSelectTable($event)"
                            [ngClass]="{ 'is-invalid': f['TableName'].touched && f['TableName'].errors }">
                            <option value={{default_select}} selected>Select table...</option>
                            <optgroup label="Tables" *ngIf="tables.length>=1">
                              <option value="{{table.tableName}}" *ngFor="let table of tables">{{table.tableName}}
                              </option>
                            </optgroup>
                            <optgroup label="External Tables" *ngIf="externalTables.length>=1">
                              <option value="{{table.tableName}}" *ngFor="let table of externalTables">
                                {{table.tableName}}
                              </option>
                            </optgroup>
                            <optgroup label="Views" *ngIf="viewTables.length>=1">
                              <option value="{{table.tableName}}" *ngFor="let table of viewTables">{{table.tableName}}
                              </option>
                            </optgroup>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="accordion-item">
                    <div class="accordion-header" id="panelsStayOpen-headingTwo">
                      <button class="accordion-button shadow-none py-1 px-2" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="true"
                        aria-controls="panelsStayOpen-collapseTwo">
                        <div class="me-2">Metrics<span class="required">*</span></div>
                        ({{runCustomQueryform.get('Functions')?.length}})
                      </button>
                    </div>
                    <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse show"
                      aria-labelledby="panelsStayOpen-headingTwo">
                      <div class="accordion-body px-2 py-0">
                        <div formArrayName="Functions">
                          <div *ngFor="let function of runCustomQueryform.get('Functions')?.controls; let i=index"
                            [formGroupName]="i">
                            <div class="input-group input-group-sm dropend mb-2">
                              <button class="btn btn-outline-danger shadow-none" style="z-index: 0;" type="button"
                                (click)="removeFunction(i)"><i class="fas fa-trash-alt"></i></button>
                              <input type="text" id="iField" class="form-control shadow-none"
                                [ngModel]="iFieldFunction[i]" [ngModelOptions]="{standalone: true}"
                                aria-label="Text input with dropdown button" readonly>
                              <button type="button" #functionspop="bs-popover"
                                class="btn btn-default btn-secondary dropdown-toggle shadow-none" style="z-index: 0;"
                                [popover]="popTemplate" placement="auto"> </button>
                            </div>
                            <ng-template #popTemplate>
                              <div class="mb-2">
                                <select id="exampleFormControlInput1" class="form-select form-select-sm shadow-none"
                                  formControlName="ColumnName" aria-label=".form-select-sm example"
                                  [ngClass]="{ 'is-invalid': function.get('ColumnName').touched && function.get('ColumnName').errors }">
                                  <option value="{{default_select}}" selected>Select column...</option>
                                  <option value="{{table_name.columN_NAME}}" *ngFor="let table_name of Tablemetadata">
                                    {{table_name.columN_NAME}}
                                    ({{table_name.datA_TYPE}})
                                  </option>
                                </select>
                              </div>
                              <div class="mb-2">
                                <select id="exampleFormControlInput2" class="form-select form-select-sm shadow-none"
                                  formControlName="Function" aria-label=".form-select-sm example"
                                  [ngClass]="{ 'is-invalid': function.get('Function').touched && function.get('Function').errors }">
                                  <option value="{{default_select}}" selected>Select function...</option>
                                  <option value="COUNT()">COUNT(*)</option>
                                  <option value="SUM()">SUM()</option>
                                  <option value="AVG()">AVG()</option>
                                  <option value="MIN()">MIN()</option>
                                  <option value="MAX()">MAX()</option>
                                </select>
                              </div>
                              <div class="d-flex mb-0">
                                <button type="button" class="btn btn-sm btn-primary shadow-none me-auto"
                                  (click)="[onConfirmFunction(i), functionspop.hide()]"
                                  [disabled]="!function.get('ColumnName').value || !function.get('Function').value">Save</button>
                                <button type="button" class="btn btn-sm btn-warning shadow-none"
                                  (click)="functionspop.hide()">Cancel</button>
                              </div>
                            </ng-template>
                          </div>
                        </div>
                        <div class="d-flex">
                          <button class="btn btn-sm shadow-none ms-auto" (click)="addFunctions()"><i
                              class="fas fa-plus"></i></button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="accordion-item">
                    <div class="accordion-header" id="panelsStayOpen-headingThree">
                      <button class="accordion-button shadow-none py-1 px-2" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="true"
                        aria-controls="panelsStayOpen-collapseThree">
                        <div class="me-2">Filter By</div>
                        ({{runCustomQueryform.get('FilterBy')?.length}})
                      </button>
                    </div>
                    <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse show"
                      aria-labelledby="panelsStayOpen-headingThree">
                      <div class="accordion-body px-2 py-0">
                        <div formArrayName="FilterBy">
                          <div *ngFor="let function of runCustomQueryform.get('FilterBy')?.controls; let i=index"
                            [formGroupName]="i">
                            <div class="input-group input-group-sm dropend mb-2">
                              <button class="btn btn-outline-danger shadow-none" type="button"
                                (click)="removeFilterBy(i)"><i class="fas fa-trash-alt"></i></button>
                              <input type="text" id="iField" class="form-control shadow-none"
                                [ngModel]="iFieldFilterBy[i]" [ngModelOptions]="{standalone: true}"
                                aria-label="Text input with dropdown button" readonly>
                              <button type="button" #filterBypop="bs-popover"
                                class="btn btn-default btn-secondary dropdown-toggle shadow-none"
                                [popover]="popTemplateFilterBy" placement="right"> </button>
                            </div>
                            <ng-template #popTemplateFilterBy>
                              <div class="mb-3">
                                <select id="exampleFormControlInput1" class="form-select form-select-sm shadow-none"
                                  formControlName="ColumnName" aria-label=".form-select-sm example">
                                  <option value="{{default_select}}" selected>Select column...</option>
                                  <option value="{{table_name.columN_NAME}}" *ngFor="let table_name of Tablemetadata">
                                    {{table_name.columN_NAME}}
                                    ({{table_name.datA_TYPE}})
                                  </option>
                                </select>
                              </div>
                              <div class="mb-3">
                                <select id="exampleFormControlInput2" class="form-select form-select-sm shadow-none"
                                  formControlName="FilterOperator" aria-label=".form-select-sm example">
                                  <option value="{{default_select}}" selected>Select Operator...</option>

                                  <optgroup label="Comparison operator">
                                    <option value="=">Equal (=)</option>
                                    <option value="<>">Not Equal (<>)</option>
                                    <option value=">">Greater than (>)</option>
                                    <option value="<">Less than (<)< /option>
                                    <option value=">=">Greater than or equal
                                      (>=)</option>
                                    <option value="<=">Less than or equal (<=)< /option>
                                  </optgroup>
                                  <optgroup label="Logical/Special Operators">
                                    <option value="IN">IN</option>
                                    <option value="NOT IN">NOT IN</option>
                                    <option value="IS NULL">IS NULL</option>
                                    <option value="IS NOT NULL">IS NOT NULL</option>
                                    <option value="BETWEEN">BETWEEN</option>
                                    <option value="NOT BETWEEN">NOT BETWEEN</option>
                                    <option value="LIKE">LIKE</option>
                                  </optgroup>

                                </select>
                              </div>
                              <div class="mb-3">
                                <input type="text" class="form-control form-control-sm shadow-none"
                                  placeholder="Filter value" aria-label="Text input with dropdown button"
                                  formControlName="FilterValue">
                              </div>
                              <div class="d-flex mb-0">
                                <button type="button" class="btn btn-sm btn-primary shadow-none me-auto"
                                  (click)="[onConfirmFilterBy(i),filterBypop.hide()]"
                                  [disabled]="!function.get('ColumnName').value || !function.get('FilterOperator').value || !function.get('FilterValue').value">Save</button>
                                <button type="button" class="btn btn-sm btn-warning  shadow-none"
                                  (click)="filterBypop.hide()">Cancel</button>
                              </div>
                            </ng-template>
                          </div>
                        </div>
                        <div class="d-flex">
                          <label for="exampleFormControlInput1" class="form-label me-auto"></label>
                          <button class="btn btn-sm shadow-none" (click)="addFilterBy()"><i
                              class="fas fa-plus"></i></button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="accordion-item">
                    <div class="accordion-header" id="panelsStayOpen-headingFour">
                      <button class="accordion-button shadow-none py-1 px-2" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseFour" aria-expanded="true"
                        aria-controls="panelsStayOpen-collapseFour">
                        <div class="me-2">Group By<span class="required">*</span></div>
                        ({{runCustomQueryform.get('GroupBy')?.length}})
                      </button>
                    </div>
                    <div id="panelsStayOpen-collapseFour" class="accordion-collapse collapse show"
                      aria-labelledby="panelsStayOpen-headingFour">
                      <div class="accordion-body px-2 py-0">
                        <div formArrayName="GroupBy">
                          <div *ngFor="let function of runCustomQueryform.get('GroupBy')?.controls; let i=index"
                            [formGroupName]="i">
                            <div class="input-group input-group-sm dropend mb-2">
                              <button class="btn btn-outline-danger shadow-none" type="button" style="z-index: 0;"
                                (click)="removeGroupBy(i)"><i class="fas fa-trash-alt"></i></button>
                              <select class="form-select form-select-sm shadow-none"
                                aria-label=".form-select-sm example" formControlName="ColumnName"
                                [ngClass]="{ 'is-invalid': function.get('ColumnName').touched && function.get('ColumnName').errors }">
                                <option value="{{default_select}}" selected>Select column...</option>
                                <option value="{{table_name.columN_NAME}}" *ngFor="let table_name of Tablemetadata">
                                  {{table_name.columN_NAME}}</option>
                              </select>
                            </div>
                          </div>
                        </div>
                        <div class="d-flex">
                          <label for="exampleFormControlInput1" class="form-label me-auto"></label>
                          <button class="btn btn-sm shadow-none" (click)="addGroupBy()"><i
                              class="fas fa-plus"></i></button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="accordion-item">
                    <div class="accordion-header" id="panelsStayOpen-headingFive">
                      <button class="accordion-button shadow-none py-1 px-2" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseFive" aria-expanded="true"
                        aria-controls="panelsStayOpen-collapseFive">
                        <div class="me-2">Sort By</div> ({{runCustomQueryform.get('SortBy')?.length}})
                      </button>
                    </div>
                    <div id="panelsStayOpen-collapseFive" class="accordion-collapse collapse show"
                      aria-labelledby="panelsStayOpen-headingFive">
                      <div class="accordion-body px-2 py-0">
                        <div formArrayName="SortBy">
                          <div *ngFor="let function of runCustomQueryform.get('SortBy')?.controls; let i=index"
                            [formGroupName]="i">
                            <div class="input-group input-group-sm dropend mb-2">
                              <button class="btn btn-outline-danger shadow-none" type="button" style="z-index: 0;"
                                (click)="removeSortBy(i)"><i class="fas fa-trash-alt"></i></button>
                              <input type="text" id="iField" class="form-control shadow-none"
                                [ngModel]="iFieldSortBy[i]" [ngModelOptions]="{standalone: true}"
                                aria-label="Text input with dropdown button" readonly>
                              <button type="button" #sortBypop="bs-popover"
                                class="btn btn-default btn-secondary dropdown-toggle shadow-none" style="z-index: 0;"
                                [popover]="popTemplateSortBy" placement="right"> </button>
                            </div>
                            <ng-template #popTemplateSortBy>
                              <div class="mb-3">
                                <select id="exampleFormControlInput1" class="form-select form-select-sm shadow-none"
                                  formControlName="ColumnName" aria-label=".form-select-sm example">
                                  <option value="{{default_select}}" selected>Select column...</option>
                                  <option value="{{table_name.columN_NAME}}" *ngFor="let table_name of Tablemetadata">
                                    {{table_name.columN_NAME}}
                                    ({{table_name.datA_TYPE}})
                                  </option>
                                </select>
                              </div>
                              <div class="mb-3">
                                <select id="exampleFormControlInput2" class="form-select form-select-sm shadow-none"
                                  formControlName="SortType" aria-label=".form-select-sm example">
                                  <option value="{{default_select}}" selected>Select Sort type...</option>
                                  <option value="ASC">ASC</option>
                                  <option value="DESC">DESC</option>
                                </select>
                              </div>
                              <div class="d-flex">
                                <button type="button" class="btn btn-sm btn-primary shadow-none me-auto"
                                  (click)="[onConfirmSortBy(i), sortBypop.hide()]"
                                  [disabled]="!function.get('ColumnName').value || !function.get('SortType').value">Save</button>
                                <button type="button" class="btn btn-sm btn-warning  shadow-none"
                                  (click)="sortBypop.hide()">Cancel</button>
                              </div>
                            </ng-template>
                          </div>
                        </div>
                        <div class="d-flex">
                          <label for="exampleFormControlInput1" class="form-label me-auto"></label>
                          <button class="btn btn-sm shadow-none" (click)="addSortBy()"><i
                              class="fas fa-plus"></i></button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </tab>
              <tab heading="Existing" customClass="customClass">Chart from existing query</tab>
            </tabset>
          </form>
          <hr *ngIf="minimizedChartLists.length>=1" style="color: white; height: 3px;">
          <div class="row gx-2 gy-2">
            <div class="col-sm-6" *ngFor="let minimizedChartList of minimizedChartLists">
              <div class="card" (click)="minimizeChart(minimizedChartList.chartId,minimizedChartList.chartName, false)">
                <div type="button" class="card-body p-2 text-truncate">{{minimizedChartList.chartName}}</div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-9">
          <div class="row gx-2 gy-2 mb-2" *ngIf="isError">
            <div class="col-sm-12">
              <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <div>{{error_message}}</div>
                <button (click)="isError=false" type="button" class="btn-close" data-bs-dismiss="alert"
                  aria-label="Close"></button>
              </div>
            </div>
          </div>

          <form [formGroup]="runCustomQueryform">
            <div formArrayName="ChartInfo">
              <div class="row gx-2 gy-2 mb-2">
                <div class="col-sm-6"
                  *ngFor="let function of runCustomQueryform.get('ChartInfo')?.controls; let i=index"
                  [formGroupName]="i">
                  <div class="card" style="z-index: inherit;" *ngIf="isChartMaximised(i)" cdkDrag m22Resizable>
                    <div class="card-header py-1 d-flex">
                      <div class="card-title me-auto">{{!function.get('ChartName').value? "Chart "+(i+1):
                        function.get('ChartName').value}}</div>

                      <button id="cogs" type="button" class="btn btn-sm shadow-none me-2" (click)="op.toggle($event)">
                        <i class="fas fa-cogs text-primary"></i> </button>
                      <button id="cogs" type="button" class="btn btn-sm shadow-none me-2"
                        (click)="copyChartToClipboard('chart_'+i,!function.get('ChartName').value?'image':function.get('ChartName').value)">
                        <i class="fas fa-camera-retro"></i>
                      </button>
                      <button id="cogs" type="button" class="btn btn-sm shadow-none me-2"
                        (click)="downloadChartData(i, !function.get('ChartName').value?'Chart '+(i+1):function.get('ChartName').value)"><i
                          class="fas fa-file-download"></i></button>

                      <div class="vl mx-3"></div>


                      <button type="button" class="btn btn-sm shadow-none mx-2"
                        (click)="minimizeChart(i, !function.get('ChartName').value?'Chart '+(i+1):function.get('ChartName').value, true)"><i
                          class="fas fa-minus"></i></button>
                      <button type="button" class="btn btn-sm shadow-none me-2" (click)="maximizeChart(i)"><i
                          class="far fa-window-maximize"></i></button>
                      <button type="button" class="btn btn-sm shadow-none" (click)="removeChartInfo(i)"><i
                          class="fas fa-window-close text-danger"></i></button>
                    </div>
                    <div class="card-body py-0" (resized)="onResizedChartCard($event)" style="overflow: hidden;">
                      <p-chart id="chart_{{i}}" [responsive]="true" [width]="chartWidth" [height]="chartHeight"
                        [type]="!function.get('ChartType').value? null:function.get('ChartType').value"
                        [data]="!function.get('FinalChartData').value? null: function.get('FinalChartData').value | makeJson"
                        [options]="!function.get('FinalChartOptions').value? null: function.get('FinalChartOptions').value | makeJson">
                      </p-chart>
                    </div>
                  </div>
                  <p-overlayPanel #op [showTransitionOptions]="'100ms'" [hideTransitionOptions]="'100ms'" [modal]="true"
                    [showCloseIcon]="false" [dismissable]="false">
                    <p-scrollPanel [style]="{width: '450px', height: '360px'}" styleClass="custombar2">
                      <div class="row gx-2 gy-2 mb-2">
                        <div class="col-sm-8">
                          <input class="form-control form-control-sm shadow-none" id="chartname"
                            formControlName="ChartName" type="text" placeholder="Name" aria-label="name"
                            [ngClass]="{ 'is-invalid': function.get('ChartName').touched && function.get('ChartName').errors }">
                        </div>
                        <div class="col-sm-4">
                          <select class="form-select form-select-sm shadow-sm" aria-label="chart type"
                            formControlName="ChartType"
                            (change)="onChangeChartType(i, $event.target.value); onSelectChartType(i, $event.target.value)"
                            [ngClass]="{ 'is-invalid': function.get('ChartType').touched && function.get('ChartType').errors }">
                            <option value='{{default_select}}' selected>Chart type...</option>
                            <option value='bar'>Bar</option>
                            <option value='line'>Line</option>
                            <option value='pie'>Pie</option>
                            <option value='radar'>Radar</option>
                            <option value='doughnut'>Doughnut</option>
                            <option value='polarArea'>Polar Area</option>
                          </select>
                        </div>
                      </div>
                      <div class="row gx-2 gy-2 mb-2">
                        <div class="col-sm-6 d-flex">
                          <div class="card w-100">
                            <div class="card-body p-2 d-flex">
                              <div class="me-auto">Title</div>
                              <button class="btn btn-sm btn-primary py-0 px-2 shadow"
                                [disabled]="(!function.get('ChartType').value) || (function.get('ChartType').value==null)"
                                (click)="title.toggle($event)">
                                <i class="fas fa-cog"></i>
                              </button>
                            </div>
                          </div>
                          <p-overlayPanel #title [showCloseIcon]="false" [dismissable]="false"
                            [style]="{width: '400px'}">
                            <p-scrollPanel [style]="{width: '100%', height: '375px'}" styleClass="custombar2">
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Show Title</label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <div class="form-check form-switch me-2">
                                        <input class="form-check-input " type="checkbox" role="switch"
                                          id="OptionsPluginsTitleDisplay" formControlName="OptionsPluginsTitleDisplay">
                                      </div>
                                      <div>{{function.get('OptionsPluginsTitleDisplay').value==true?'Yes':'No'}}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Title</label>
                                </div>
                                <div class="col-sm-7">
                                  <input class="form-control form-control-sm shadow-none w-100"
                                    formControlName="OptionsPluginsTitleText" id="OptionsPluginsTitleText" type="text"
                                    placeholder="Title" aria-label="title">
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Position</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none"
                                    formControlName="OptionsPluginsTitlePosition"
                                    aria-label="OptionsPluginsTitlePosition">
                                    <option value="top">Top</option>
                                    <option value="bottom">Bottom</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Align</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none"
                                    formControlName="OptionsPluginsTitleAlign" aria-label="OptionsPluginsTitleAlign">
                                    <option value="start">Start</option>
                                    <option value="center">Center</option>
                                    <option value="end">End</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Font Style</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none"
                                    id="OptionsPluginsTitleFontStyle" formControlName="OptionsPluginsTitleFontStyle"
                                    aria-label="OptionsPluginsTitleFontStyle">
                                    <option value="normal" style="font-style: normal;">Normal</option>
                                    <option value="italic" style="font-style: italic;">Italic</option>
                                    <option value="oblique" style="font-style: oblique;">Oblique</option>
                                    <option value="initial" style="font-style: initial;">Initial</option>
                                    <option value="inherit" style="font-style: inherit;">Inherit</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Font Weight</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none"
                                    id="OptionsPluginsTitleFontWeight" formControlName="OptionsPluginsTitleFontWeight"
                                    aria-label="OptionsPluginsTitleFontWeight">
                                    <option value="normal" style="font-weight: normal;">Normal</option>
                                    <option value="bold" style="font-weight: bold;">Bold</option>
                                    <option value="bolder" style="font-weight: bolder;">Bolder</option>
                                    <option value="lighter" style="font-weight: lighter;">Lighter</option>
                                    <option value="initial" style="font-weight: initial;">Initial</option>
                                    <option value="inherit" style="font-weight: inherit;">Inherit</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Text Color
                                  </label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <input type="color" formControlName="OptionsPluginsTitleColor"
                                        id="OptionsPluginsTitleColor"
                                        class="form-control form-control-color shadow-sm p-0 me-2" title="Title color">
                                      <div>
                                        {{function.get('OptionsPluginsTitleColor').value | uppercase }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Font Size
                                    {{function.get('OptionsPluginsTitleFontSize').value}}</label>
                                </div>
                                <div class="col-sm-7">
                                  <input id="OptionsPluginsTitleFontSize" formControlName="OptionsPluginsTitleFontSize"
                                    type="range" min="5" max="25" step="1" style="width: 100%;">
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Padding Top
                                    {{function.get('OptionsPluginsTitlePaddingTop').value}}</label>
                                </div>
                                <div class="col-sm-7">
                                  <input id="OptionsPluginsTitlePaddingTop"
                                    formControlName="OptionsPluginsTitlePaddingTop" type="range" min="0" max="10"
                                    step="1" style="width: 100%;">
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Padding
                                    Bottom {{function.get('OptionsPluginsTitlePaddingBottom').value}}</label>
                                </div>
                                <div class="col-sm-7">
                                  <input id="OptionsPluginsTitlePaddingBottom"
                                    formControlName="OptionsPluginsTitlePaddingBottom" type="range" min="0" max="10"
                                    step="1" style="width: 100%;">
                                </div>
                              </div>
                            </p-scrollPanel>
                            <ng-template pTemplate>
                              <div class="d-flex">
                                <button (click)="title.hide($event)"
                                  class="btn btn-sm btn-warning ms-auto">Close</button>
                              </div>
                            </ng-template>
                          </p-overlayPanel>
                        </div>
                        <div class="col-sm-6 d-flex">
                          <div class="card w-100">
                            <div class="card-body p-2 d-flex">
                              <div class="me-auto">Subtitle</div>
                              <button class="btn btn-sm btn-primary py-0 px-2 shadow"
                                [disabled]="(!function.get('ChartType').value) || (function.get('ChartType').value==null)"
                                (click)="subtitle.toggle($event)">
                                <i class="fas fa-cog"></i>
                              </button>
                            </div>
                          </div>
                          <p-overlayPanel #subtitle [showCloseIcon]="false" [dismissable]="false"
                            [style]="{width: '400px'}">
                            <p-scrollPanel [style]="{width: '100%', height: '375px'}" styleClass="custombar2">
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Show
                                    Subtitle</label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <div class="form-check form-switch me-2">
                                        <input class="form-check-input " type="checkbox" role="switch"
                                          id="OptionsPluginsSubtitleDisplay"
                                          formControlName="OptionsPluginsSubtitleDisplay">
                                      </div>
                                      <div>{{function.get('OptionsPluginsSubtitleDisplay').value==true?'Yes':'No'}}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Subtitle</label>
                                </div>
                                <div class="col-sm-7">
                                  <input class="form-control form-control-sm shadow-none"
                                    formControlName="OptionsPluginsSubtitleText" id="OptionsPluginsSubtitleText"
                                    type="text" placeholder="Subtitle" aria-label="Subtitle">
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Position</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none"
                                    formControlName="OptionsPluginsSubtitlePosition"
                                    aria-label="OptionsPluginsSubtitlePosition">
                                    <option value="top">Top</option>
                                    <option value="bottom">Bottom</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Align</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none"
                                    formControlName="OptionsPluginsSubtitleAlign"
                                    aria-label="OptionsPluginsSubtitleAlign">
                                    <option value="start">Start</option>
                                    <option value="center">Center</option>
                                    <option value="end">End</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Font Style</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none"
                                    id="OptionsPluginsSubtitleFontStyle"
                                    formControlName="OptionsPluginsSubtitleFontStyle"
                                    aria-label="OptionsPluginsSubtitleFontStyle">
                                    <option value="normal" style="font-style: normal;">Normal</option>
                                    <option value="italic" style="font-style: italic;">Italic</option>
                                    <option value="oblique" style="font-style: oblique;">Oblique</option>
                                    <option value="initial" style="font-style: initial;">Initial</option>
                                    <option value="inherit" style="font-style: inherit;">Inherit</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Font
                                    Weight</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none"
                                    id="OptionsPluginsSubtitleFontWeight"
                                    formControlName="OptionsPluginsSubtitleFontWeight"
                                    aria-label="OptionsPluginsSubtitleFontWeight">
                                    <option value="normal" style="font-weight: normal;">Normal</option>
                                    <option value="bold" style="font-weight: bold;">Bold</option>
                                    <option value="bolder" style="font-weight: bolder;">Bolder</option>
                                    <option value="lighter" style="font-weight: lighter;">Lighter</option>
                                    <option value="initial" style="font-weight: initial;">Initial</option>
                                    <option value="inherit" style="font-weight: inherit;">Inherit</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Text Color</label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <input type="color" formControlName="OptionsPluginsSubtitleColor"
                                        id="OptionsPluginsSubtitleColor"
                                        class="form-control form-control-color shadow-sm p-0 me-2" title="Title color">
                                      <div>
                                        {{function.get('OptionsPluginsSubtitleColor').value | uppercase }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Font Size
                                    {{function.get('OptionsPluginsSubtitleFontSize').value}}</label>
                                </div>
                                <div class="col-sm-7">
                                  <input id="OptionsPluginsSubtitleFontSize"
                                    formControlName="OptionsPluginsSubtitleFontSize" type="range" min="2" max="20"
                                    step="1" style="width: 100%;">
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label for="OptionsPluginsSubtitlePaddingTop" class="form-label">Padding
                                    Top {{function.get('OptionsPluginsSubtitlePaddingTop').value}}</label>
                                </div>
                                <div class="col-sm-7">
                                  <input id="OptionsPluginsSubtitlePaddingTop"
                                    formControlName="OptionsPluginsSubtitlePaddingTop" type="range" min="0" max="10"
                                    step="1" style="width: 100%;">
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label for="OptionsPluginsSubtitlePaddingBottom" class="form-label">Padding
                                    Bottom {{function.get('OptionsPluginsSubtitlePaddingBottom').value}}</label>
                                </div>
                                <div class="col-sm-7">
                                  <input id="OptionsPluginsSubtitlePaddingBottom"
                                    formControlName="OptionsPluginsSubtitlePaddingBottom" type="range" min="0" max="10"
                                    step="1" style="width: 100%;">
                                </div>
                              </div>
                            </p-scrollPanel>
                            <ng-template pTemplate>
                              <div class="d-flex">
                                <button (click)="subtitle.hide($event)"
                                  class="btn btn-sm btn-warning ms-auto">Close</button>
                              </div>
                            </ng-template>
                          </p-overlayPanel>

                        </div>
                      </div>
                      <div class="row gx-2 gy-2 mb-2">
                        <div class="col-sm-6">
                          <div class="card w-100">
                            <div class="card-body p-2 d-flex">
                              <div class="me-auto">Chart Options</div>
                              <button class="btn btn-sm btn-primary py-0 px-2 shadow"
                                [disabled]="!function.get('ChartType').value" (click)="chartoptions.toggle($event)">
                                <i class="fas fa-cog"></i>
                              </button>
                            </div>
                          </div>
                          <p-overlayPanel #chartoptions [showCloseIcon]="false" [dismissable]="false"
                            [style]="{width: '400px'}">
                            <p-scrollPanel [style]="{width: '100%', height: '350px'}" styleClass="custombar2">

                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('BarOptionsScalesXYStacked').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">Is Stacked</label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <div class="form-check form-switch me-2">
                                        <input class="form-check-input " type="checkbox" role="switch"
                                          id="BarOptionsScalesXYStacked" formControlName="BarOptionsScalesXYStacked">
                                      </div>
                                      <div>
                                        {{function.get('BarOptionsScalesXYStacked').value==true?'Yes':'No'}}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="row gx-2 gy-2 mb-2" [hidden]="function.get('BarOptionsIndexAxis').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">Chart Orientation</label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="form-check form-check-inline">
                                    <input class="form-check-input" formControlName="BarOptionsIndexAxis" type="radio"
                                      id="inlineRadio1" value="x">
                                    <label class="form-check-label" for="inlineRadio1">Vertical</label>
                                  </div>
                                  <div class="form-check form-check-inline">
                                    <input class="form-check-input" formControlName="BarOptionsIndexAxis" type="radio"
                                      id="inlineRadio2" value="y">
                                    <label class="form-check-label" for="inlineRadio2">Horizontal</label>
                                  </div>
                                  <!-- <div class="row">
                                          <div class="col-sm-12 d-flex">
                                            <div class="form-check form-switch me-2">
                                              <input class="form-check-input " type="checkbox" role="switch"
                                                id="BarOptionsScalesXYStacked"
                                                formControlName="BarOptionsScalesXYStacked">
                                            </div>
                                            <div>
                                              {{function.get('BarOptionsScalesXYStacked').value==true?'Yes':'No'}}
                                            </div>
                                          </div>
                                        </div> -->
                                </div>
                              </div>


                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('BarLineOptionsScalesXYTitleDisplay').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">Show Axis
                                    Title</label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <div class="form-check form-switch me-2">
                                        <input class="form-check-input " type="checkbox" role="switch"
                                          id="BarLineOptionsScalesXYTitleDisplay"
                                          formControlName="BarLineOptionsScalesXYTitleDisplay">
                                      </div>
                                      <div>
                                        {{function.get('BarLineOptionsScalesXYTitleDisplay').value==true?'Yes':'No'}}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('BarLineOptionsScalesXTitleText').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">X-Axis Text</label>
                                </div>
                                <div class="col-sm-7">
                                  <input class="form-control form-control-sm shadow-none"
                                    formControlName="BarLineOptionsScalesXTitleText" id="BarLineOptionsScalesXTitleText"
                                    type="text" placeholder="X-Axis Text" aria-label="X-Axis Title">
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('BarLineOptionsScalesYTitleText').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">Y-Axis Text</label>
                                </div>
                                <div class="col-sm-7">
                                  <input class="form-control form-control-sm shadow-none"
                                    formControlName="BarLineOptionsScalesYTitleText" id="BarLineOptionsScalesYTitleText"
                                    type="text" placeholder="Y-Axis Text" aria-label="Y-Axis Text">
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('BarLineOptionsScalesXYTitleFontSize').disabled">
                                <div class="col-sm-5">
                                  <label for="BarLineOptionsScalesXYTitleFontSize" class="form-label">Axis Font Size
                                    {{function.get('BarLineOptionsScalesXYTitleFontSize').value}}</label>
                                </div>
                                <div class="col-sm-7">
                                  <input id="BarLineOptionsScalesXYTitleFontSize"
                                    formControlName="BarLineOptionsScalesXYTitleFontSize" type="range" min="5" max="25"
                                    step="1" style="width: 100%;">
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('BarLineOptionsScalesXYTitleFontStyle').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">Axis Font
                                    Style</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none"
                                    id="BarLineOptionsScalesXYTitleFontStyle"
                                    formControlName="BarLineOptionsScalesXYTitleFontStyle"
                                    aria-label="BarLineOptionsScalesXYTitleFontStyle">
                                    <option value="normal" style="font-style: normal;">Normal</option>
                                    <option value="italic" style="font-style: italic;">Italic</option>
                                    <option value="oblique" style="font-style: oblique;">Oblique</option>
                                    <option value="initial" style="font-style: initial;">Initial</option>
                                    <option value="inherit" style="font-style: inherit;">Inherit</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('BarLineOptionsScalesXYTitleFontWeight').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">Axis Font
                                    Weight</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none"
                                    id="BarLineOptionsScalesXYTitleFontWeight"
                                    formControlName="BarLineOptionsScalesXYTitleFontWeight"
                                    aria-label="BarLineOptionsScalesXYTitleFontWeight">
                                    <option value="normal" style="font-weight: normal;">Normal</option>
                                    <option value="bold" style="font-weight: bold;">Bold</option>
                                    <option value="bolder" style="font-weight: bolder;">Bolder</option>
                                    <option value="lighter" style="font-weight: lighter;">Lighter</option>
                                    <option value="initial" style="font-weight: initial;">Initial</option>
                                    <option value="inherit" style="font-weight: inherit;">Inherit</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('BarLineOptionsScalesXYTitleColor').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">Axis Title Color
                                  </label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <input type="color" formControlName="BarLineOptionsScalesXYTitleColor"
                                        id="BarLineOptionsScalesXYTitleColor"
                                        class="form-control form-control-color shadow-sm p-0 me-2"
                                        title="Axis Title color">
                                      <div>
                                        {{function.get('BarLineOptionsScalesXYTitleColor').value | uppercase }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('BarLineOptionsScalesXYTicksColor').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">XY Ticks Color
                                  </label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <input type="color" formControlName="BarLineOptionsScalesXYTicksColor"
                                        id="BarLineOptionsScalesXYTicksColor"
                                        class="form-control form-control-color shadow-sm p-0 me-2" title="Ticks color">
                                      <div>
                                        {{function.get('BarLineOptionsScalesXYTicksColor').value | uppercase }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('BarLineOptionsScalesXYGridColor').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">Grid Color
                                  </label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <input type="color" formControlName="BarLineOptionsScalesXYGridColor"
                                        id="BarLineOptionsScalesXYGridColor"
                                        class="form-control form-control-color shadow-sm p-0 me-2" title="Grid color">
                                      <div>
                                        {{function.get('BarLineOptionsScalesXYGridColor').value | uppercase }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('RadarPolarareaOptionsScalesRGridColor').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">Grid Color
                                  </label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <input type="color" formControlName="RadarPolarareaOptionsScalesRGridColor"
                                        id="RadarPolarareaOptionsScalesRGridColor"
                                        class="form-control form-control-color shadow-sm p-0 me-2" title="Grid color">
                                      <div>
                                        {{function.get('RadarPolarareaOptionsScalesRGridColor').value | uppercase }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2"
                                [hidden]="function.get('RadarOptionsScalesRPointlabelsColor').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">Point Lable
                                    Color
                                  </label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <input type="color" formControlName="RadarOptionsScalesRPointlabelsColor"
                                        id="RadarOptionsScalesRPointlabelsColor"
                                        class="form-control form-control-color shadow-sm p-0 me-2" title="Ticks color">
                                      <div>
                                        {{function.get('RadarOptionsScalesRPointlabelsColor').value | uppercase }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2"
                                [hidden]="function.get('RadarOptionsScalesRAnglelinesColor').disabled">
                                <div class="col-sm-5">
                                  <label class="form-label">Angle Line
                                    Color
                                  </label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <input type="color" formControlName="RadarOptionsScalesRAnglelinesColor"
                                        id="RadarOptionsScalesRAnglelinesColor"
                                        class="form-control form-control-color shadow-sm p-0 me-auto"
                                        title="Angle line color">
                                      <div>
                                        {{function.get('RadarOptionsScalesRAnglelinesColor').value | uppercase }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </p-scrollPanel>
                            <ng-template pTemplate>
                              <div class="d-flex">
                                <button (click)="chartoptions.hide($event)"
                                  class="btn btn-sm btn-warning ms-auto">Close</button>
                              </div>
                            </ng-template>
                          </p-overlayPanel>
                        </div>
                        <div class="col-sm-6">
                          <div class="card w-100">
                            <div class="card-body p-2 d-flex">
                              <div class="me-auto">Miscellaneous</div>
                              <button class="btn btn-sm btn-primary py-0 px-2 shadow"
                                [disabled]="(!function.get('ChartType').value) || (function.get('ChartType').value==null)"
                                (click)="tooltip.toggle($event)">
                                <i class="fas fa-cog"></i>
                              </button>
                            </div>
                          </div>
                          <p-overlayPanel #tooltip [showCloseIcon]="false" [dismissable]="false"
                            [style]="{width: '400px'}">
                            <p-scrollPanel [style]="{width: '100%', height: '115px'}" styleClass="custombar2">
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Tooltips Mode</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none" id="OptionsPluginsTooltipsMode"
                                    formControlName="OptionsPluginsTooltipsMode"
                                    aria-label="OptionsPluginsTooltipsMode">
                                    <option value="point">Point</option>
                                    <option value="nearest">Nearest</option>
                                    <option value="index">Index</option>
                                    <option value="dataset">Dataset</option>
                                    <option value="x">X</option>
                                    <option value="y">Y</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Tooltips
                                    Intersect</label>
                                </div>
                                <div class="col-sm-7">
                                  <select class="form-select form-select-sm shadow-none"
                                    id="OptionsPluginsTooltipsIntersect"
                                    formControlName="OptionsPluginsTooltipsIntersect"
                                    aria-label="OptionsPluginsTooltipsIntersect">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-5">
                                  <label class="form-label">Legend Label
                                    Color</label>
                                </div>
                                <div class="col-sm-7">
                                  <div class="row">
                                    <div class="col-sm-12 d-flex">
                                      <input type="color" formControlName="OptionsPluginsLegendLabelsColor"
                                        id="OptionsPluginsLegendLabelsColor"
                                        class="form-control form-control-color shadow-none p-0 me-2"
                                        title="Legend Label color">
                                      <div>{{function.get('OptionsPluginsLegendLabelsColor').value | uppercase }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </p-scrollPanel>
                            <ng-template pTemplate>
                              <div class="d-flex">
                                <button (click)="tooltip.hide($event)"
                                  class="btn btn-sm btn-warning ms-auto">Close</button>
                              </div>
                            </ng-template>
                          </p-overlayPanel>
                        </div>
                      </div>
                      <hr style="height:2px;border-width:0;color:gray;background-color:gray">

                      <!-- <div class="row gx-2 gy-2">
                        <div class="col-sm-12">
                          <div class="input-group input-group-sm mb-3">
                            <div class="col-sm-5">
                              <select class="form-select form-select-sm shadow-sm" formControlName="ChartYAxis"
                                aria-label="y-axis/Attribute">
                                <option value="{{default_select}}" selected>Select Metrics...</option>
                                <option *ngFor="let key of datasetKeys" value="{{key}}">
                                  {{key}}
                                </option>
                              </select>
                            </div>
                            <span>
                              <select class="form-select form-select-sm shadow-none" aria-label="Atribute order">
                                <option value="{{default_select}}" selected>Select Order...</option>
                                <option value="ASC">ASC</option>
                                <option value="DESC">DESC</option>
                              </select>
                            </span>
                            <span>
                              <select class="form-select form-select-sm shadow-sm" formControlName="ChartYAxisFunction"
                                aria-label=".form-select-sm example" style="width: 4rem;">
                                <option value="{{default_select}}" selected>Function...</option>
                                <option value="COUNT">COUNT</option>
                                <option value="SUM">SUM</option>
                                <option value="AVG">AVG</option>
                                <option value="MIN">MIN</option>
                                <option value="MAX">MAX</option>
                              </select>
                            </span>
                          </div>
                        </div>
                      </div> -->

                      <div class="row gx-2 gy-2 mb-2">
                        <div class="col-sm-7">
                          <div class="input-group input-group-sm mb-3">
                            <select class="form-select form-select-sm shadow-none" formControlName="ChartXAxis"
                              aria-label="x-axis/Attribute">
                              <option value="{{default_select}}" selected>Select Attribute...</option>
                              <option *ngFor="let key of datasetKeys" value="{{key}}">{{key}}</option>
                            </select>
                            <span>
                              <select class="form-select form-select-sm shadow-none" formControlName="ChartXAxisOrder"
                                aria-label="Atribute order">
                                <option value="{{default_select}}" selected>Order...</option>
                                <option value="ASC">ASC</option>
                                <option value="DESC">DESC</option>
                              </select>
                            </span>
                          </div>
                        </div>
                        <div class="col-sm-5">
                          <button class="btn btn-sm btn-primary shadow-sm me-auto w-100"
                            [disabled]="(!function.get('ChartType').value) || (function.get('ChartType').value==null)"
                            (click)="addChartYAxisInfo(i); onChangeChartType(i, function.get('ChartType').value )">
                            <i class="fas fa-plus me-2"></i>
                            Add Metrics
                          </button>
                        </div>
                      </div>
                      <div class="row gx-2 gy-2 mb-2">
                        <div class="col-sm-12">
                          <div formArrayName="ChartYAxisInfo">
                            <div *ngFor="let func of ChartYAxisInfo(i).controls; let j=index" [formGroupName]="j">
                              <div class="row gx-2 gy-2 mb-2">
                                <div class="col-sm-7">
                                  <div class="input-group input-group-sm">
                                    <select class="form-select form-select-sm shadow-sm" formControlName="ChartYAxis"
                                      aria-label="y-axis/Attribute">
                                      <option value="{{default_select}}" selected>Metrics...</option>
                                      <option *ngFor="let key of datasetKeys" value="{{key}}">
                                        {{key}}
                                      </option>
                                    </select>
                                    <span>
                                      <select class="form-select form-select-sm shadow-none"
                                        formControlName="ChartYAxisOrder" aria-label="Atribute order">
                                        <option value="{{default_select}}" selected>Order...</option>
                                        <option value="ASC">ASC</option>
                                        <option value="DESC">DESC</option>
                                      </select>
                                    </span>
                                  </div>
                                </div>
                                <div class="col-sm-5 d-flex">
                                  <div class="input-group input-group-sm">
                                    <select class="form-select form-select-sm shadow-sm"
                                      formControlName="ChartYAxisFunction" aria-label=".form-select-sm example">
                                      <option value="{{default_select}}" selected>Function...</option>
                                      <option value="COUNT">COUNT</option>
                                      <option value="SUM">SUM</option>
                                      <option value="AVG">AVG</option>
                                      <option value="MIN">MIN</option>
                                      <option value="MAX">MAX</option>
                                    </select>
                                    <button class="btn btn-sm btn-secondary shadow-sm" type="button"
                                      (click)="yaxis.toggle($event)" id=" button-addon2"><i
                                        class="fas fa-cog"></i></button>
                                  </div>
                                  <button type="button" class="btn btn-sm shadow-none ms-3"
                                    (click)="removeChartYAxisInfo(i, j)"><i
                                      class="fas fa-trash-alt text-danger"></i></button>
                                </div>
                              </div>
                              <p-overlayPanel #yaxis [showTransitionOptions]="'100ms'" [hideTransitionOptions]="'100ms'"
                                [showCloseIcon]="false" [dismissable]="false" [style]="{width: '400px'}">
                                <p-scrollPanel [style]="{width: '100%', height: '200px'}" styleClass="custombar2">
                                  <div class="row gx-2 gy-2 mb-2"
                                    [hidden]="func.get('LineBarRadarPolarDatasetsLabel').disabled">
                                    <div class="col-sm-12">
                                      <input class="form-control form-control-sm shadow-sm" type="text"
                                        placeholder="Metric Label" formControlName="LineBarRadarPolarDatasetsLabel"
                                        aria-label="Metric Label">
                                    </div>
                                  </div>
                                  <div class="row gx-2 gy-2 mb-2"
                                    [hidden]="func.get('LineBarRadarDatasetsBackgroundColor').disabled">
                                    <div class="col-sm-7">
                                      <label class="form-label">Background Color</label>
                                    </div>
                                    <div class="col-sm-5">
                                      <div class="row">
                                        <div class="col-sm-12 d-flex">
                                          <input type="color" id="BarDatasetsBackgroundColor"
                                            class="form-control form-control-color shadow-sm p-0 me-3"
                                            formControlName="LineBarRadarDatasetsBackgroundColor">
                                          <div>{{func.get('LineBarRadarDatasetsBackgroundColor').value}}</div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="row gx-2 gy-2 mb-2" [hidden]="func.get('LineDatasetsFill').disabled">
                                    <div class="col-sm-7">
                                      <label class="form-label">Fill Color</label>
                                    </div>
                                    <div class="col-sm-5 d-flex">
                                      <div class="form-check form-switch me-2">
                                        <input class="form-check-input " type="checkbox" role="switch"
                                          id="LineDatasetsFill" formControlName="LineDatasetsFill">
                                      </div>
                                      <div>{{func.get('LineDatasetsFill').value==true?'Yes':'No'}}
                                      </div>
                                    </div>
                                  </div>
                                  <div class="row gx-2 gy-2 mb-2" [hidden]="func.get('LineDatasetsTension').disabled">
                                    <div class="col-sm-7">
                                      <label class="form-label">Line Tension
                                        {{func.get('LineDatasetsTension').value}}</label>
                                    </div>
                                    <div class="col-sm-5">
                                      <input type="range" min="0.1" max="1" step="0.1"
                                        formControlName="LineDatasetsTension">
                                    </div>
                                  </div>
                                  <div class="row gx-2 gy-2 mb-2"
                                    [hidden]="func.get('LineRadarDatasetsBorderColor').disabled">
                                    <div class="col-sm-7">
                                      <label class="form-label">Border Color</label>
                                    </div>
                                    <div class="col-sm-5 d-flex">
                                      <input type="color" class="form-control form-control-color shadow-sm p-0 me-3"
                                        formControlName="LineRadarDatasetsBorderColor">
                                      <div>{{func.get('LineRadarDatasetsBorderColor').value}}</div>
                                    </div>
                                  </div>
                                  <div class="row gx-2 gy-2 mb-2"
                                    [hidden]="func.get('RadarDatasetsPointBackgroundColor').disabled">
                                    <div class="col-sm-7">
                                      <label class="form-label">Poin BG Color</label>
                                    </div>
                                    <div class="col-sm-5 d-flex">
                                      <input type="color" class="form-control form-control-color shadow-sm p-0 me-3"
                                        formControlName="RadarDatasetsPointBackgroundColor">
                                      <div>{{func.get('RadarDatasetsPointBackgroundColor').value}}</div>
                                    </div>
                                  </div>
                                  <div class="row gx-2 gy-2 mb-2"
                                    [hidden]="func.get('RadarDatasetsPointBorderColor').disabled">
                                    <div class="col-sm-7">
                                      <label class="form-label">Poin Border Color</label>
                                    </div>
                                    <div class="col-sm-5 d-flex">
                                      <input type="color" class="form-control form-control-color shadow-sm p-0 me-3"
                                        formControlName="RadarDatasetsPointBorderColor">
                                      <div>{{func.get('RadarDatasetsPointBorderColor').value}}</div>
                                    </div>
                                  </div>
                                  <div class="row gx-2 gy-2 mb-2"
                                    [hidden]="func.get('RadarDatsetsPointHoverBackgroundColor').disabled">
                                    <div class="col-sm-7">
                                      <label class="form-label">Poin Hover BG Color</label>
                                    </div>
                                    <div class="col-sm-5 d-flex">
                                      <input type="color" class="form-control form-control-color shadow-sm p-0 me-3"
                                        formControlName="RadarDatsetsPointHoverBackgroundColor">
                                      <div>{{func.get('RadarDatsetsPointHoverBackgroundColor').value}}</div>
                                    </div>
                                  </div>
                                  <div class="row gx-2 gy-2 mb-2"
                                    [hidden]="func.get('RadarDatasetsPointHoverBorderColor').disabled">
                                    <div class="col-sm-7">
                                      <label class="form-label">Poin Hover Border Color</label>
                                    </div>
                                    <div class="col-sm-5 d-flex">
                                      <input type="color" class="form-control form-control-color shadow-sm p-0 me-3"
                                        formControlName="RadarDatasetsPointHoverBorderColor">
                                      <div>{{func.get('RadarDatasetsPointHoverBorderColor').value}}</div>
                                    </div>
                                  </div>
                                </p-scrollPanel>
                                <ng-template pTemplate>
                                  <div class="d-flex">
                                    <button (click)="yaxis.hide($event)"
                                      class="btn btn-sm btn-warning ms-auto">Close</button>
                                  </div>
                                </ng-template>
                              </p-overlayPanel>
                            </div>
                          </div>
                        </div>
                      </div>
                    </p-scrollPanel>
                    <ng-template pTemplate>
                      <div class="d-flex">
                        <button class="btn btn-sm btn-primary shadow-sm me-auto"
                          (click)="CreateChart(i);op.hide($event); title.hide($event); subtitle.hide($event); tooltip.hide($event);chartoptions.hide($event);">Create
                          Chart</button>
                        <button
                          (click)="op.hide($event); title.hide($event); subtitle.hide($event); tooltip.hide($event) ;chartoptions.hide($event);"
                          class="btn btn-sm btn-warning">Close</button>
                      </div>
                    </ng-template>
                  </p-overlayPanel>
                </div>
              </div>

            </div>
          </form>

          <div class="row gx-2 gy-2 mb-2">
            <div class="col-sm-12">
              <div *ngIf="resultData.length>=1" class="card" cdkDrag>
                <div class="card-body">
                  <p-table #dt [columns]="cols" [paginator]="true" [rows]="10" [showCurrentPageReport]="true"
                    urrentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                    [rowsPerPageOptions]="[10,25,50]" [value]="resultData" styleClass="p-datatable-sm" [rowHover]="true"
                    responsiveLayout="scroll" [globalFilterFields]="['{{cols.header}}']">
                    <ng-template pTemplate="caption">
                      <div class="d-flex ">
                        <div class="flex-grow-1">
                          Dataset
                        </div>
                        <div class="bd-highlight me-0">
                          <button class="btn btn-sm btn-outline-primary shadow-sm" (click)="dt.exportCSV()"><i
                              class="fas fa-file-download me-1"></i>CSV</button>
                        </div>
                        <!-- <div class="bd-highlight">
                          <div class="input-group input-group-sm">
                            <span class="input-group-text" id="basic-addon1"><i class="fas fa-search"></i></span>
                            <input (input)="dt.filterGlobal($event.target.value, 'contains')" type="text"
                              class="form-control shadow-none" placeholder="Search" aria-label="Search"
                              aria-describedby="basic-addon1">
                          </div>
                        </div> -->
                      </div>
                    </ng-template>
                    <ng-template pTemplate="header" let-columns>
                      <tr>
                        <th *ngFor="let col of columns" pSortableColumn="{{col.header}}">
                          {{col.header}} <p-sortIcon field="{{col.header}}"></p-sortIcon>
                        </th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-rowData let-columns="columns">
                      <tr>
                        <td *ngFor="let col of columns">
                          {{rowData[col.field]}}
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>

<p-confirmPopup></p-confirmPopup>

<p-dialog header="Configs" [(visible)]="display" [modal]="true" [style]="{width: '30vw'}" (onHide)="onHideDialog()"
  styleClass="pDialog">
  <div class="mb-2 row">
    <label for="charttitle" class="col-sm-3 col-form-label">Title</label>
    <div class="col-sm-9">
      <input #chart_name class="form-control form-control-sm shadow-none" id="charttitle" type="text"
        placeholder="Chart Name" [ngModel]="runCustomQueryform.get('ChartName'+chartNumber)?.value"
        aria-label="chart-name">
    </div>
  </div>
  <div class="row mb-2">
    <label for="chartsubtitle" class="col-sm-3 col-form-label">Sub Title</label>
    <div class="col-sm-9">
      <input #chart_sub_name class="form-control form-control-sm shadow-none" id="chartsubtitle" type="text"
        placeholder="Sub Title" aria-label="chart-name" disabled>
    </div>
  </div>
  <div class="row mb-3">
    <label for="xaxis" class="col-sm-3 col-form-label">X-Axis</label>
    <div class="col-sm-9">
      <select #xAxis [ngModel]="runCustomQueryform.get('xAxis'+chartNumber)?.value"
        class="form-select form-select-sm shadow-none" id="xaxis" aria-label=".form-select-sm example">
        <option value="{{default_select}}" selected>X-Axis/Attributes</option>
        <option value="{{item}}" *ngFor="let item of xAxisItems">
          {{item}}</option>
      </select>
    </div>
  </div>
  <div class="row mb-2">
    <label for="yaxis" class="col-sm-3 col-form-label">Y-Axis</label>
    <div class="col-sm-9">
      <select #yAxis [ngModel]="runCustomQueryform.get('yAxis'+chartNumber)?.value"
        class="form-select form-select-sm shadow-none" id="yaxis" aria-label=".form-select-sm example">
        <option value="{{default_select}}" selected>Y-Axis/Metrices</option>
        <option *ngFor="let item of yAxisItems" value="{{item}}">{{item}}</option>
      </select>
    </div>
  </div>
  <div class="row mb-2">
    <label for="charttype" class="col-sm-3 col-form-label">Chart Type</label>
    <div class="col-sm-9">
      <select #chartType [ngModel]="runCustomQueryform.get('ChartType'+chartNumber)?.value"
        class="form-select form-select-sm shadow-none" id="charttype" aria-label="charttype">
        <option value="{{default_select}}" selected>Select Chart type</option>
        <option *ngIf="resultData.length>=1" value="1">Line Chart</option>
        <option *ngIf="resultData.length>=1" value="2">Bar Chart</option>
      </select>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-112">
      <button class="btn btn-sm btn-primary"
        (click)="createChart(chartNumber, chart_name.value, chartType.value, xAxis.value, yAxis.value )">Generate
        chart</button>
    </div>
  </div>
</p-dialog>

<p-dialog header="Save Chart" [(visible)]="displaySaveQuery" [modal]="true" [style]="{width: '25vw'}"
  (onHide)="onHideSaveQueryDialog(); removeValidatorToWorkspaceName()">
  <form [formGroup]="runCustomQueryform">
    <div class="row mb-2">
      <div class="col-sm-12">
        <input formControlName="CustomQueryName" [value]="runCustomQueryform.get('CustomQueryName')!.value"
          class="form-control form-control-sm shadow-sm" type="text" placeholder="Name" aria-label="name">
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 d-flex">
        <button *ngIf="isSave" class="btn btn-sm btn-success shadow-sm w-100" (click)="saveChartData()"
          [disabled]="runCustomQueryform.invalid">
          <div *ngIf="!saveCustomQuery_loading"><i class="fas fa-save me-2"></i>Save</div>
          <div *ngIf="saveCustomQuery_loading" class="spinner-border spinner-border-sm text-light" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </button>

        <button *ngIf="isSaveAs" class="btn btn-sm btn-success shadow-sm w-100" (click)="saveAsChartData()"
          [disabled]="runCustomQueryform.invalid">
          <div *ngIf="!saveCustomQuery_loading"><i class="fas fa-copy me-2"></i>Save As</div>
          <div *ngIf="saveCustomQuery_loading" class="spinner-border spinner-border-sm text-light" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </button>
      </div>
    </div>
  </form>
</p-dialog>

<p-dialog position="center" header="Workspaces" [(visible)]="displayAllQueries" [modal]="true"
  [style]="{width: '92%', height: '82%'}" [baseZIndex]="10000" [draggable]="false" [resizable]="true"
  (onHide)="onHideAllQueriesDialog()">
  <p-table #dt [value]="allWorkSpaces" responsiveLayout="scroll" [resizableColumns]="true" sortMode="multiple"
    styleClass="p-datatable-gridlines" columnResizeMode="expand" [rowHover]="true"
    [globalFilterFields]="['customQueryName','tableName','addedBy','addedDate', 'updatedBy', 'updatedDate']">
    <ng-template pTemplate="caption">
      <div class="d-flex">
        <div class="me-auto">In total there are {{allWorkSpaces ? allWorkSpaces.length : 0 }} workspaces.</div>
        <div class="ms-auto">
          <input class="form-control form-control-sm shadow-none" type="text" placeholder="Search" aria-label="searcch"
            (input)="dt.filterGlobal($event.target.value, 'contains')">
        </div>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th pResizableColumn pSortableColumn="customQueryName">Workspace <p-sortIcon field="customQueryName">
          </p-sortIcon>
        </th>
        <th pResizableColumn pSortableColumn="tableName">Table <p-sortIcon field="tableName"></p-sortIcon>
        </th>
        <th pResizableColumn pSortableColumn="addedBy">Added By <p-sortIcon field="addedBy"></p-sortIcon>
        </th>
        <th pResizableColumn pSortableColumn="addedDate">Added Date <p-sortIcon field="addedDate"></p-sortIcon>
        </th>
        <th pResizableColumn pSortableColumn="updatedBy">Updated By <p-sortIcon field="updatedBy"></p-sortIcon>
        </th>
        <th pResizableColumn pSortableColumn="updatedDate">Updated Date <p-sortIcon field="updatedDate"></p-sortIcon>
        </th>
        <th> </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-allWorkSpace>
      <tr>
        <td>{{allWorkSpace.customQueryName}}</td>
        <td>{{allWorkSpace.tableName}}</td>
        <td>{{allWorkSpace.addedBy}}</td>
        <td>{{allWorkSpace.addedDate? (allWorkSpace.addedDate+'Z'| date:'short'): null}}</td>
        <td>{{allWorkSpace.updatedBy}}</td>
        <td>{{allWorkSpace.updatedDate? (allWorkSpace.updatedDate+'Z'| date:'short'):null}}</td>
        <td>
          <button type="button" class="btn btn-sm btn-info shadow-sm me-3"
            (click)="SetCustomQueryToEdit(allWorkSpace.customQueryId)"><i class="far fa-edit"></i></button>
          <button class="btn btn-sm btn-outline-danger shadow-sm"
            (click)="DeleteCustomQuery(allWorkSpace.customQueryId, $event)"> <i class="fas fa-trash-alt"></i> </button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-dialog>